;[101]
;-----------------------------------------------
@CHARA_INFO
#DIM NO_PAGE
#DIM TMP_TARGET
#DIM SORT_SELECT
#DIM SORT_ACT
#DIM CHARA_SORT, 1000
#DIM L_LCOUNT
#DIM CONST NUM_PAGE = 24
;-----------------------------------------------

$DRAW_LIST
L_LCOUNT = LINECOUNT

REDRAW 0

;标题栏
CUSTOMDRAWLINE =
PRINTFORM 请选择一名干员档案以了解详细信息。\t\t<第{NO_PAGE+1}页> 
PRINTFORML (总计{CHARANUM-1}人)
DRAWLINE 

$SELECT_LOOP

;列出清单
IF SORT_SELECT == 1200
	CALL SHOW_CHARA_INFO_LIST(NO_PAGE)
ELSE
	SORT_SELECT = 1200
	CALL SHOW_CHARA_INFO_LIST(NO_PAGE)
ENDIF
;PRINTFORM [1200] %"概览",12,LEFT%
;PRINTFORM [1300] %"身体状况",12,LEFT%
;TODO:未实装，用于刀客塔的‘体液疗法’选择目标
PRINTL
DRAWLINE
PRINTLC [997] 上一页
PRINTLC [999] 返回	
PRINTLC [998] 下一页
PRINTL

;输入
$INPUT_LOOP
INPUT

;处理输入
SELECTCASE RESULT
CASE 1200
	IF SORT_SELECT != RESULT
		SORT_SELECT = RESULT
		CLEARLINE LINECOUNT-L_LCOUNT
		GOTO DRAW_LIST
	ELSEIF RESULT == 1300
		SORT_ACT++
		CLEARLINE LINECOUNT-L_LCOUNT
		GOTO DRAW_LIST
	ENDIF
CASE 999		;返回
	REDRAW 1
	RETURN 0 
CASE 997		;上一页
	IF NO_PAGE > 0
		NO_PAGE --
		CLEARLINE LINECOUNT-L_LCOUNT
		GOTO DRAW_LIST
	ENDIF
CASE 998		;下一页
	IF (NO_PAGE+1) * NUM_PAGE <= CHARANUM
		NO_PAGE ++
		CLEARLINE LINECOUNT-L_LCOUNT
		GOTO DRAW_LIST
	ENDIF
CASE 0 TO CHARANUM -1
	SIF RESULT == 0 && MASTER
		RESULT = MASTER
	Target = RESULT
	;CALL SHOW_CHARA_INFO_VIEWPORT(RESULT)
	;加载，页面深入到内部具体人物页面
	;IF RESULT == 1
		;REDRAW 1
		;返回值1结束当前回合
		;其他返回值回到人物列表
		;RETURN 1
	;ENDIF
	GOTO DRAW_LIST
ENDSELECT

CLEARLINE 1
GOTO INPUT_LOOP


;-----------------------------------------------
@SHOW_CHARA_INFO_LIST(NO_PAGE = 0)
#DIM MAX_NUM_LEN = 0
#DIM MAX_NAME_LEN = 0
#DIM MAX_STAR_LEN = 0
#DIM NO_PAGE
#DIM CONST NUM_PAGE = 24
;-----------------------------------------------
;人数：{CHARANUM-1}
 
;确定列表使用的文字长度
MAX_NUM_LEN = STRLENS(TOSTR((NO_PAGE+1)*NUM_PAGE));序号
FOR COUNT, 0, CHARANUM
	MAX_NAME_LEN = MAX(STRLENS(NAME:COUNT), MAX_NAME_LEN);姓名
	MAX_STAR_LEN = MAX(BASE:COUNT:2, MAX_STAR_LEN);星级
NEXT

LIST_HEADER = NO_PAGE*NUM_PAGE + 1
LIST_FOOTER = (NO_PAGE+1)*NUM_PAGE + 1
SIF LIST_HEADER > MASTER && MASTER
	LIST_HEADER ++
SIF LIST_FOOTER > MASTER && MASTER
	LIST_FOOTER ++
; 第一行
LOCALS = [{0,MAX_NUM_LEN}]
PRINTFORML %LOCALS, MAX_NUM_LEN+2, RIGHT%  你
;%LOCALS, MAX_NUM_LEN+2, RIGHT% 　　　　 %NAME:MASTER, MAX_NAME_LEN,LEFT% LV{CFLAG:MASTER:9, MAX_LV_LEN,RIGHT}

FOR COUNT, LIST_HEADER, LIST_FOOTER
	
	SIF COUNT == MASTER
		CONTINUE
	IF COUNT >= CHARANUM
		PRINTL
		CONTINUE
	ENDIF
	;序号
	LOCALS = [{COUNT,MAX_NUM_LEN}]
	PRINTFORM %LOCALS, MAX_NUM_LEN + 2, RIGHT% 
	;当前位置Or找人
	;CALL SHOW_CHARA_ACT(COUNT)
	;名称
	PRINTFORM  %NAME:COUNT,MAX_NAME_LEN,LEFT% 
	;干员类型
	PRINTFORM  【%ARR_职业:(TALENT:COUNT:7)%】
	;星级
	;todo:增加变色
	FOR LOCAL, 0, MAX_STAR_LEN
		IF LOCAL < BASE:COUNT:3
			PRINT ★
		ELSE
			PRINT   
		ENDIF
	NEXT
	;属性
	PRINTFORM  体力%BARSTR(BASE:COUNT:0,MAXBASE:COUNT:0,8)% 气力%BARSTR(BASE:COUNT:1,MAXBASE:COUNT:1,8)%
	;信赖值
	PRINTFORM  信赖度{(CFLAG:COUNT:50),4,RIGHT}\%
	
	;状态TODO:修改状态值
	IF BASE:COUNT:6 == 2
		SETCOLOR 255,100,100
		PRINT <精英二>
		RESETCOLOR
	ELSEIF BASE:COUNT:6 == 1
		SETCOLOR 255,100,100
		PRINT <精英一>
		RESETCOLOR
	ELSE
		SETCOLOR 100,100,100
		PRINT <未晋升>
		RESETCOLOR
	ENDIF
	;关注的干员
	IF CFLAG:COUNT:700
		PRINTFORM  [☆]
	ELSE
		PRINTS " "*5
	ENDIF
	RESETCOLOR
	PRINTS " "*9
	PRINTL 
NEXT

;各种干员数量的统计
@CHARA_NUM(ARGS)
#FUNCTION
#DIM LCOUNT

LOCAL = 0
SELECTCASE ARGS
CASE "近卫干员"
	FOR LCOUNT, 2, CHARANUM
		SIF TALENT:LCOUNT:ARGS
			LOCAL += 1
	NEXT
CASEELSE
	FOR LCOUNT, 2, CHARANUM
		SIF TALENT:LCOUNT:ARGS
			LOCAL += 1
	NEXT
ENDSELECT
RETURNF LOCAL

@LIFE_BAR (ARG:0 = -1, ARG:1 = 0)
;输出生命值
LOCAL:1 = -1
IF ARG:0 >= 0 && ARG:0 < CHARANUM
	LOCAL:1 = TARGET
	TARGET = ARG:0
ENDIF

IF MAXBASE:体力 <= 0
	SIF LOCAL:1 != -1
		TARGET = LOCAL:1;終わるときにはTARGETを戻す
	RETURN 0
ENDIF

PRINT 体力
IF BASE:体力 < 0
	BAR 0,MAXBASE:体力,32
	PRINTFORM (   0/{MAXBASE:体力})
ELSE
	BAR BASE:体力,MAXBASE:体力,32
	PRINTFORM ({BASE:0, 4}/{MAXBASE:0})
ENDIF
IF BASE:体力 < 0
	PRINT ★瘫软★
ELSEIF BASE:0 < 500
	PRINT ★脱力★
ENDIF
SIF ARG:1 == 0
	PRINTL 
	SIF LOCAL:1 != -1
		TARGET = LOCAL:1;
